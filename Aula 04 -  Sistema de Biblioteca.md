# üöÄ Aula 4 - Pr√°tica: Criando um Sistema de Biblioteca com Testes Automatizados

## üéØ Objetivos da Aula

* Aplicar os conceitos das aulas anteriores em um projeto pr√°tico
* Desenvolver testes unit√°rios para um sistema real
* Praticar com annotations JUnit e m√©todos de asser√ß√£o
* Criar artefatos de teste completos
* Implementar testes parametrizados e de exce√ß√µes

---

## üìö Cen√°rio: Sistema de Gerenciamento de Biblioteca

Vamos criar um sistema para gerenciar uma biblioteca digital. O sistema precisa controlar livros, empr√©stimos e usu√°rios.

### üìã Requisitos do Sistema (RF - Requisitos Funcionais)

**RF001** - Cadastrar livros no sistema  
**RF002** - Registrar usu√°rios da biblioteca  
**RF003** - Realizar empr√©stimo de livros  
**RF004** - Devolver livros emprestados  
**RF005** - Consultar livros dispon√≠veis  
**RF006** - Validar multas por atraso na devolu√ß√£o

---

## üèóÔ∏è Estrutura do Projeto

### üìå Classe Principal: Livro

```java
public class Livro {
    private String isbn;
    private String titulo;
    private String autor;
    private boolean disponivel;
    private int anoPublicacao;

    public Livro(String isbn, String titulo, String autor, int anoPublicacao) {
        this.isbn = isbn;
        this.titulo = titulo;
        this.autor = autor;
        this.anoPublicacao = anoPublicacao;
        this.disponivel = true;
    }

    // Getters e Setters
    public String getIsbn() { return isbn; }
    public String getTitulo() { return titulo; }
    public String getAutor() { return autor; }
    public boolean isDisponivel() { return disponivel; }
    public int getAnoPublicacao() { return anoPublicacao; }
    public void setDisponivel(boolean disponivel) { this.disponivel = disponivel; }
}
```

### üìå Classe Principal: Usuario

```java
public class Usuario {
    private String id;
    private String nome;
    private String email;
    private boolean possuiMulta;

    public Usuario(String id, String nome, String email) {
        this.id = id;
        this.nome = nome;
        this.email = email;
        this.possuiMulta = false;
    }

    // Getters e Setters
    public String getId() { return id; }
    public String getNome() { return nome; }
    public String getEmail() { return email; }
    public boolean isPossuiMulta() { return possuiMulta; }
    public void setPossuiMulta(boolean possuiMulta) { this.possuiMulta = possuiMulta; }
}
```

### üìå Classe Principal: Biblioteca

```java
import java.time.LocalDate;
import java.time.temporal.ChronoUnit;
import java.util.ArrayList;
import java.util.List;

public class Biblioteca {
    private List<Livro> livros;
    private List<Usuario> usuarios;
    private List<Emprestimo> emprestimos;

    public Biblioteca() {
        this.livros = new ArrayList<>();
        this.usuarios = new ArrayList<>();
        this.emprestimos = new ArrayList<>();
    }

    public void adicionarLivro(Livro livro) {
        if (livro == null) {
            throw new IllegalArgumentException("Livro n√£o pode ser nulo");
        }
        livros.add(livro);
    }

    public void registrarUsuario(Usuario usuario) {
        if (usuario == null) {
            throw new IllegalArgumentException("Usu√°rio n√£o pode ser nulo");
        }
        usuarios.add(usuario);
    }

    public boolean emprestarLivro(String isbn, String usuarioId, LocalDate dataEmprestimo) {
        Livro livro = buscarLivroPorIsbn(isbn);
        Usuario usuario = buscarUsuarioPorId(usuarioId);

        if (livro == null || usuario == null) {
            return false;
        }

        if (!livro.isDisponivel() || usuario.isPossuiMulta()) {
            return false;
        }

        livro.setDisponivel(false);
        Emprestimo emprestimo = new Emprestimo(livro, usuario, dataEmprestimo);
        emprestimos.add(emprestimo);
        return true;
    }

    public double devolverLivro(String isbn, LocalDate dataDevolucao) {
        Emprestimo emprestimo = buscarEmprestimoAtivo(isbn);
        if (emprestimo == null) {
            return -1; // Empr√©stimo n√£o encontrado
        }

        Livro livro = emprestimo.getLivro();
        livro.setDisponivel(true);

        // Calcular multa se houver atraso
        long diasAtraso = ChronoUnit.DAYS.between(emprestimo.getDataDevolucaoPrevista(), dataDevolucao);
        double multa = 0;
        
        if (diasAtraso > 0) {
            multa = diasAtraso * 2.0; // R$ 2,00 por dia de atraso
            emprestimo.getUsuario().setPossuiMulta(true);
        }

        emprestimo.setDataDevolucaoReal(dataDevolucao);
        return multa;
    }

    public List<Livro> listarLivrosDisponiveis() {
        return livros.stream()
                .filter(Livro::isDisponivel)
                .toList();
    }

    private Livro buscarLivroPorIsbn(String isbn) {
        return livros.stream()
                .filter(l -> l.getIsbn().equals(isbn))
                .findFirst()
                .orElse(null);
    }

    private Usuario buscarUsuarioPorId(String id) {
        return usuarios.stream()
                .filter(u -> u.getId().equals(id))
                .findFirst()
                .orElse(null);
    }

    private Emprestimo buscarEmprestimoAtivo(String isbn) {
        return emprestimos.stream()
                .filter(e -> e.getLivro().getIsbn().equals(isbn) && e.getDataDevolucaoReal() == null)
                .findFirst()
                .orElse(null);
    }
}
```

### üìå Classe Auxiliar: Emprestimo

```java
import java.time.LocalDate;

public class Emprestimo {
    private Livro livro;
    private Usuario usuario;
    private LocalDate dataEmprestimo;
    private LocalDate dataDevolucaoPrevista;
    private LocalDate dataDevolucaoReal;

    public Emprestimo(Livro livro, Usuario usuario, LocalDate dataEmprestimo) {
        this.livro = livro;
        this.usuario = usuario;
        this.dataEmprestimo = dataEmprestimo;
        this.dataDevolucaoPrevista = dataEmprestimo.plusDays(14); // 14 dias para devolu√ß√£o
    }

    // Getters e Setters
    public Livro getLivro() { return livro; }
    public Usuario getUsuario() { return usuario; }
    public LocalDate getDataEmprestimo() { return dataEmprestimo; }
    public LocalDate getDataDevolucaoPrevista() { return dataDevolucaoPrevista; }
    public LocalDate getDataDevolucaoReal() { return dataDevolucaoReal; }
    public void setDataDevolucaoReal(LocalDate dataDevolucaoReal) { 
        this.dataDevolucaoReal = dataDevolucaoReal; 
    }
}
```

---

## üß™ ATIVIDADE PR√ÅTICA: Implementar Testes Automatizados

### üìù Parte 1: Criar os Casos de Teste

**Crie um documento com os seguintes casos de teste:**

| CTID | Descri√ß√£o | Pr√©-condi√ß√µes | Passos | Resultado Esperado |
|------|-----------|---------------|--------|-------------------|
| CT001 | Cadastrar livro v√°lido | - | 1. Criar livro com ISBN, t√≠tulo, autor<br>2. Adicionar √† biblioteca | Livro cadastrado com sucesso |
| CT002 | Cadastrar livro nulo | - | 1. Tentar adicionar livro nulo | Deve lan√ßar IllegalArgumentException |
| CT003 | Empr√©stimo bem-sucedido | Livro dispon√≠vel, usu√°rio sem multa | 1. Registrar empr√©stimo | Empr√©stimo realizado com sucesso |
| CT004 | Empr√©stimo com livro indispon√≠vel | Livro emprestado | 1. Tentar empr√©stimo | Empr√©stimo deve falhar |

### üìù Parte 2: Implementar Testes Unit√°rios

**Complete a classe de testes abaixo:**

```java
import org.junit.jupiter.api.*;
import java.time.LocalDate;
import static org.junit.jupiter.api.Assertions.*;

class BibliotecaTest {
    private Biblioteca biblioteca;
    private Livro livro1;
    private Livro livro2;
    private Usuario usuario1;
    private Usuario usuario2;

    @BeforeEach
    void setUp() {
        biblioteca = new Biblioteca();
        
        livro1 = new Livro("123456", "Dom Casmurro", "Machado de Assis", 1899);
        livro2 = new Livro("789012", "O Corti√ßo", "Alu√≠sio Azevedo", 1890);
        
        usuario1 = new Usuario("U001", "Jo√£o Silva", "joao@email.com");
        usuario2 = new Usuario("U002", "Maria Santos", "maria@email.com");
        
        // TODO: Adicionar livros e usu√°rios √† biblioteca
    }

    @Test
    @DisplayName("‚úÖ Deve cadastrar livro com sucesso")
    void testCadastrarLivro() {
        // TODO: Implementar teste para cadastro de livro
        // Verificar se livro foi adicionado √† biblioteca
    }

    @Test
    @DisplayName("‚ùå Deve lan√ßar exce√ß√£o ao cadastrar livro nulo")
    void testCadastrarLivroNulo() {
        // TODO: Implementar teste para livro nulo
        // Usar assertThrows para verificar exce√ß√£o
    }

    @Test
    @DisplayName("‚úÖ Deve realizar empr√©stimo com sucesso")
    void testEmprestarLivro() {
        // TODO: Implementar teste de empr√©stimo bem-sucedido
        // Verificar se livro ficou indispon√≠vel
    }

    @Test
    @DisplayName("‚ùå N√£o deve emprestar livro indispon√≠vel")
    void testEmprestarLivroIndisponivel() {
        // TODO: Implementar teste para livro j√° emprestado
    }

    @ParameterizedTest
    @DisplayName("üí∞ Deve calcular multa corretamente")
    @ValueSource(ints = {0, 5, 10}) // Dias de atraso
    void testCalcularMulta(int diasAtraso) {
        // TODO: Implementar teste parametrizado para c√°lculo de multa
        // Dica: usar LocalDate.now().plusDays(diasAtraso) para data de devolu√ß√£o
    }

    @Test
    @DisplayName("üìö Deve listar apenas livros dispon√≠veis")
    void testListarLivrosDisponiveis() {
        // TODO: Implementar teste para listagem de livros dispon√≠veis
        // Emprestar um livro e verificar se n√£o aparece na lista
    }

    @Test
    @DisplayName("‚è∞ Deve bloquear empr√©stimo para usu√°rio com multa")
    void testUsuarioComMulta() {
        // TODO: Implementar teste para usu√°rio com multa
        // Configurar usu√°rio com multa e tentar empr√©stimo
    }

    @AfterEach
    void tearDown() {
        // TODO: Limpar recursos se necess√°rio
    }
}
```

### üìù Parte 3: Criar Artefatos de Teste

**Desenvolva os seguintes documentos:**

#### 1. Plano de Teste para o Sistema de Biblioteca

---

# Plano de Teste - Sistema de Biblioteca

## 1. Objetivo
Validar o funcionamento do sistema de gerenciamento de biblioteca.

## 2. Escopo
- Testes unit√°rios para todas as classes
- Testes de integra√ß√£o entre m√≥dulos
- Testes de funcionalidades cr√≠ticas

## 3. Estrat√©gia
- Desenvolvimento dirigido por testes (TDD)
- Cobertura m√≠nima de 80% do c√≥digo
- Testes automatizados com JUnit 5

## 4. Crit√©rios de Aceita√ß√£o
- Todos os testes devem passar
- C√≥digo deve estar livre de bugs cr√≠ticos
- Performance: opera√ß√µes em menos de 100ms

---

#### 2. Matriz de Rastreabilidade

| Requisito | Casos de Teste | Status |
|-----------|----------------|--------|
| RF001 | CT001, CT002 | üîÑ |
| RF002 | CT003, CT007 | üîÑ |
| RF003 | CT003, CT004, CT007 | üîÑ |
| RF004 | CT005 | üîÑ |
| RF005 | CT006 | üîÑ |
| RF006 | CT005 | üîÑ |

### üìù Parte 4: Desafio Avan√ßado (Opcional)

**Implemente testes para cen√°rios complexos:**

```java
@Test
@DisplayName("üéØ Teste integrado: fluxo completo de empr√©stimo e devolu√ß√£o")
void testFluxoCompleto() {
    // TODO: Implementar um teste que simule o fluxo completo:
    // 1. Cadastrar livro e usu√°rio
    // 2. Realizar empr√©stimo
    // 3. Verificar indisponibilidade do livro
    // 4. Realizar devolu√ß√£o com atraso
    // 5. Verificar c√°lculo de multa
    // 6. Confirmar que livro est√° dispon√≠vel novamente
}

@Test
@DisplayName("üîç Teste de performance com m√∫ltiplos empr√©stimos")
void testPerformanceMultiplosEmprestimos() {
    // TODO: Implementar teste de performance
    // Usar assertTimeout para verificar tempo de execu√ß√£o
    // Simular 100 empr√©stimos simult√¢neos
}
```

---

## üìä Crit√©rios de Avalia√ß√£o

| Crit√©rio | Peso | Descri√ß√£o |
|----------|------|-----------|
| **Completude dos testes** | 40% | Todos os m√©todos principais testados |
| **Qualidade dos casos de teste** | 20% | Casos bem documentados e coesos |
| **Uso correto das annotations** | 20% | @BeforeEach, @Test, @ParameterizedTest, etc. |
| **Artefatos de teste** | 20% | Plano e matriz de rastreabilidade completos |

---

## üéØ Resultado Esperado

Ao final desta atividade, os alunos devem ter:

‚úÖ **Sistema de biblioteca funcional** com classes completas  
‚úÖ **Suite de testes abrangente** cobrindo todos os cen√°rios  
‚úÖ **Artefatos de teste profissionais** (plano, casos, matriz)  
‚úÖ **Dom√≠nio pr√°tico** das annotations e assertions do JUnit  
‚úÖ **Experi√™ncia real** com desenvolvimento orientado a testes  

---

## üí° Dicas 

1. **Comece pelos testes mais simples** (cadastro de livros)
2. **Use o m√©todo `assertThrows`** para testar exce√ß√µes
3. **Experimente com `@ParameterizedTest`** para evitar c√≥digo repetitivo
4. **Verifique sempre os estados antes e depois** das opera√ß√µes
5. **Documente bem os casos de teste** para facilitar a manuten√ß√£o

**üöÄ Boa sorte! Qualquer d√∫vida, estarei aqui tomando caf√© ‚òï.**
